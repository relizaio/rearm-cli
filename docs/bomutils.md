# xBOM Utilities

Base Command: `bomutils`

## 9.1 Fix incorrect OCI purl generated via cdxgen
purl generated for an oci artifact via cdxgen contains incorrect purls; as per the [spec](https://github.com/package-url/purl-spec/blob/main/PURL-TYPES.rst#oci) `oci` purls must be registry agnostic by default.

use this utility command to fix such purls in an SBOM.

e.g. 

Sample command:

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils fixpurl \
    --ociimage image_with_SHA_DIGEST \ 
    -f input-bom.json \
    -o output-bom.json
```

Read from stdin and write to stdout


```bash
cat bom_samples/rebom-ui-oci.json | docker run --rm -i registry.relizahub.com/library/rearm-cli    \
    bomutils fixpurl \
    --ociimage image_with_SHA_DIGEST
```

Flags stand for:
- **--ociimage** - flag to specify oci image with digest
- **--infile (-f)** - input cyclonedx sbom json file. (Optional - reades from stdin when not specified)
- **--outfile (-o)** - output file path to write bom json. (Optional - writes to stdout when not specified)
- **--newpurl** - new purl to be set, will attempt to autogenerate if missing (but will autogenerate for oci only)


## 9.2 BOM Enrichment with BEAR

BOMs generated by many tools are missing supplier and license data. Use these commands to enrich BOMs using [Project BEAR](https://github.com/relizaio/bear).

### 9.2.1 Enrich Supplier Only

Enriches components where supplier is missing or has unresolved values (NOASSERTION, unresolved, undetected, other).

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils enrichsupplier \
    --bearUri https://mybear.com \
    --bearApiKey mykey \
    -f input-bom.json \
    -o output-bom.json
```

### 9.2.2 Enrich License Only

Enriches components where license is missing, contains `LicenseRef-scancode`, or has unresolved values (NOASSERTION, unresolved, undetected, other).

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils enrichlicense \
    --bearUri https://mybear.com \
    --bearApiKey mykey \
    -f input-bom.json \
    -o output-bom.json
```

### 9.2.3 Enrich Both Supplier and License

Combined enrichment that updates supplier (if missing/unresolved) and license (if missing/unresolved/contains LicenseRef-scancode) in a single operation.

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils enrich \
    --bearUri https://mybear.com \
    --bearApiKey mykey \
    -f input-bom.json \
    -o output-bom.json
```

### Flags

- **--bearUri** - URI of BEAR service to use, defaults to https://beardemo.rearmhq.com
- **--bearApiKey** - API Key for BEAR service authentication
- **--infile (-f)** - input cyclonedx sbom json file (optional - reads from stdin when not specified)
- **--outfile (-o)** - output file path to write bom json (optional - writes to stdout when not specified)
- **--debug (-d)** - set to "true" to print enrichment statistics

## 9.3 Convert SPDX to CycloneDX

The `convert-spdx` command converts SPDX 2.2/2.3 JSON BOMs to CycloneDX 1.6 JSON format with high fidelity preservation of metadata, licenses, PURLs, and dependencies.

Sample command:

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils convert-spdx \
    --infile input-spdx.json \
    --outfile output-cyclonedx.json \
    --validate
```

Flags stand for:
- **--infile** - Input SPDX JSON file path (required)
- **--outfile** - Output CycloneDX JSON file path (required)  
- **--validate** - Validate the generated CycloneDX BOM (optional)

## 9.4 Merge Multiple BOMs

The `merge-boms` command allows you to merge multiple CycloneDX BOMs into a single consolidated BOM. This is useful when you have multiple BOMs from different components or services that need to be combined into a unified view.

Currently only works with CycloneDX 1.6.

Sample command:

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils merge-boms \
    --input-files bom1.json,bom2.json,bom3.json \
    --name "merged-application" \
    --version "1.0.0" \
    --group "com.example" \
    --structure FLAT \
    --outfile merged-bom.json
```

Sample command with hierarchical structure:

```bash
docker run --rm registry.relizahub.com/library/rearm-cli    \
    bomutils merge-boms \
    --input-files frontend-bom.json,backend-bom.json \
    --name "full-stack-app" \
    --version "2.1.0" \
    --structure HIERARCHICAL \
    --root-component-merge-mode PRESERVE_UNDER_NEW_ROOT \
    --purl "pkg:generic/full-stack-app@2.1.0"
```

Flags stand for:
- **--input-files** - Comma-separated list of input BOM file paths to merge (required)
- **--name** - Name for the new root component of the merged BOM (optional)
- **--version** - Version for the new root component of the merged BOM (optional)
- **--group** - Group for the new root component of the merged BOM (optional)
- **--structure** - Structure of the merged BOM: FLAT or HIERARCHICAL (default: FLAT)
- **--root-component-merge-mode** - How to handle root components: PRESERVE_UNDER_NEW_ROOT or FLATTEN_UNDER_NEW_ROOT (default: PRESERVE_UNDER_NEW_ROOT)
- **--purl** - Set bom-ref and purl for the root merged component (optional)
- **--outfile** - Output file path to write merged BOM (optional - writes to stdout when not specified)
